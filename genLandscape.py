
tabPoints = [
{"idx":0		, "X":  0	    , "Y" :61},
{"idx":1		, "X":  13	    , "Y" :77},
{"idx":2		, "X":  26	    , "Y" :62},
{"idx":3		, "X":  38	    , "Y" :77},
{"idx":4		, "X":  46	    , "Y" :88},
{"idx":5		, "X":  63	    , "Y" :46},
{"idx":6		, "X":  96	    , "Y" :88},
{"idx":7		, "X":  113	    , "Y" :62},
{"idx":8		, "X":  126	    , "Y" :77},
{"idx":9		, "X":  149	    , "Y" :62},
{"idx":10		, "X":  170	    , "Y" :88},
{"idx":11		, "X":  179	    , "Y" :88},
{"idx":12		, "X":  199	    , "Y" :62},
{"idx":13		, "X":  220	    , "Y" :88},
{"idx":14		, "X":  255	    , "Y" :88},
{"idx":15		, "X":  275	    , "Y" :62},
{"idx":16		, "X":  288	    , "Y" :78},
{"idx":17		, "X":  295	    , "Y" :88},
{"idx":18		, "X":  300	    , "Y" :63},
{"idx":19		, "X":  313	    , "Y" :78},
{"idx":20		, "X":  321	    , "Y" :88},
{"idx":21		, "X":  329	    , "Y" :88},
{"idx":22		, "X":  337	    , "Y" :47},
{"idx":23		, "X":  349	    , "Y" :61},
{"idx":24		, "X":  362	    , "Y" :47},
{"idx":25		, "X":  377	    , "Y" :63},
{"idx":26		, "X":  415	    , "Y" :88},
{"idx":27		, "X":  454	    , "Y" :88},
{"idx":28		, "X":  464	    , "Y" :78},
{"idx":29		, "X":  471	    , "Y" :83},
{"idx":30		, "X":  480	    , "Y" :88},
{"idx":31		, "X":  488	    , "Y" :61},
{"idx":32		, "X":  509	    , "Y" :88},
{"idx":33		, "X":  513	    , "Y" :88},
{"idx":34		, "X":  531	    , "Y" :45},
{"idx":35		, "X":  535	    , "Y" :49},
{"idx":36		, "X":  540	    , "Y" :49},
{"idx":37		, "X":  544	    , "Y" :45},
{"idx":38		, "X":  561	    , "Y" :88},
{"idx":39		, "X":  578	    , "Y" :88},
{"idx":40		, "X":  587	    , "Y" :78},
{"idx":41		, "X":  595	    , "Y" :88},
{"idx":42		, "X":  603	    , "Y" :88},
{"idx":43		, "X":  624	    , "Y" :61},
{"idx":44		, "X":  636	    , "Y" :45},
{"idx":45		, "X":  645	    , "Y" :88},
{"idx":46		, "X":  653	    , "Y" :88},
{"idx":47		, "X":  661	    , "Y" :76},
{"idx":48		, "X":  686	    , "Y" :45},
{"idx":49		, "X":  697	    , "Y" :59},
{"idx":50		, "X":  710	    , "Y" :45},
{"idx":51		, "X":  735	    , "Y" :76},
{"idx":52		, "X":  743	    , "Y" :88},
{"idx":53		, "X":  768	    , "Y" :88},
{"idx":54		, "X":  776	    , "Y" :88},
{"idx":55		, "X":  797	    , "Y" :61},
{"idx":56		, "X":  809	    , "Y" :76},
{"idx":57		, "X":  821	    , "Y" :61},
{"idx":58		, "X":  842	    , "Y" :88},
{"idx":59		, "X":  900	    , "Y" :88},
{"idx":60		, "X":  921	    , "Y" :61},
{"idx":61		, "X":  941	    , "Y" :88},
{"idx":62		, "X":  970	    , "Y" :45},
{"idx":63		, "X":  984	    , "Y" :61},
{"idx":64		, "X":  997	    , "Y" :77},
{"idx":65		, "X":  1010	, "Y" :62},
{"idx":66		, "X":  1022	, "Y" :77},
{"idx":67		, "X":  1030	, "Y" :88},
{"idx":68		, "X":  1047	, "Y" :46},
{"idx":69		, "X":  1080	, "Y" :88},
{"idx":70		, "X":  1097	, "Y" :62},
{"idx":71		, "X":  1110	, "Y" :77},
{"idx":72		, "X":  1133	, "Y" :62},
{"idx":73		, "X":  1154	, "Y" :88},
{"idx":74		, "X":  1163	, "Y" :88},
{"idx":75		, "X":  1183	, "Y" :62},
{"idx":76		, "X":  1204	, "Y" :88},
{"idx":77		, "X":  1239	, "Y" :88},
{"idx":78		, "X":  1259	, "Y" :62}]


tabSegments=[
{'idx':0	,'idxPt1': 0	, 'idxPt2': 1},
{'idx':1	,'idxPt1': 1	, 'idxPt2': 2},
{'idx':2	,'idxPt1': 2	, 'idxPt2': 4},
{'idx':3	,'idxPt1': 3	, 'idxPt2': 5},
{'idx':4	,'idxPt1': 5	, 'idxPt2': 6},
{'idx':5	,'idxPt1': 6	, 'idxPt2': 7},
{'idx':6	,'idxPt1': 7	, 'idxPt2': 8},
{'idx':7	,'idxPt1': 8	, 'idxPt2': 9},
{'idx':8	,'idxPt1': 9	, 'idxPt2':10},
{'idx':9	,'idxPt1': 11	, 'idxPt2':12},
{'idx':10	,'idxPt1': 12	, 'idxPt2':13},
{'idx':11	,'idxPt1': 14	, 'idxPt2':15},
{'idx':12	,'idxPt1': 15	, 'idxPt2':17},
{'idx':13	,'idxPt1': 16	, 'idxPt2':18},
{'idx':14	,'idxPt1': 18	, 'idxPt2':20},
{'idx':15	,'idxPt1': 19	, 'idxPt2':22},
{'idx':16	,'idxPt1': 21	, 'idxPt2':23},
{'idx':17	,'idxPt1': 23	, 'idxPt2':24},
{'idx':18	,'idxPt1': 24	, 'idxPt2':25},
{'idx':19	,'idxPt1': 26	, 'idxPt2':27},
{'idx':20	,'idxPt1': 27	, 'idxPt2':29},
{'idx':21	,'idxPt1': 28	, 'idxPt2':30},
{'idx':22	,'idxPt1': 30	, 'idxPt2':31},
{'idx':23	,'idxPt1': 32	, 'idxPt2':33},
{'idx':24	,'idxPt1': 33	, 'idxPt2':34},
{'idx':25	,'idxPt1': 34	, 'idxPt2':35},
{'idx':26	,'idxPt1': 35	, 'idxPt2':36},
{'idx':27	,'idxPt1': 36	, 'idxPt2':37},
{'idx':28	,'idxPt1': 38	, 'idxPt2':39},
{'idx':29	,'idxPt1': 39	, 'idxPt2':40},
{'idx':30	,'idxPt1': 41	, 'idxPt2':42},
{'idx':31	,'idxPt1': 42	, 'idxPt2':43},
{'idx':32	,'idxPt1': 42	, 'idxPt2':44},
{'idx':33	,'idxPt1': 43	, 'idxPt2':46},
{'idx':34	,'idxPt1': 45	, 'idxPt2':47},
{'idx':35	,'idxPt1': 47	, 'idxPt2':48},
{'idx':36	,'idxPt1': 48	, 'idxPt2':49},
{'idx':37	,'idxPt1': 49	, 'idxPt2':51},
{'idx':38	,'idxPt1': 50	, 'idxPt2':52},
{'idx':39	,'idxPt1': 52	, 'idxPt2':53},
{'idx':40	,'idxPt1': 54	, 'idxPt2':55},
{'idx':41	,'idxPt1': 55	, 'idxPt2':56},
{'idx':42	,'idxPt1': 56	, 'idxPt2':57},
{'idx':43	,'idxPt1': 57	, 'idxPt2':58},
{'idx':44	,'idxPt1': 59	, 'idxPt2':60},
{'idx':45	,'idxPt1': 60	, 'idxPt2':61},
{'idx':46	,'idxPt1': 61	, 'idxPt2':62},
{'idx':47	,'idxPt1': 62	, 'idxPt2':63},
{'idx':48	,'idxPt1': 63	, 'idxPt2':64},
{'idx':49	,'idxPt1': 64	, 'idxPt2':65},
{'idx':50	,'idxPt1': 65	, 'idxPt2':67},
{'idx':51	,'idxPt1': 66	, 'idxPt2':68},
{'idx':52	,'idxPt1': 68	, 'idxPt2':69},
{'idx':53	,'idxPt1': 69	, 'idxPt2':70},
{'idx':54	,'idxPt1': 70	, 'idxPt2':71},
{'idx':55	,'idxPt1': 71	, 'idxPt2':72},
{'idx':56	,'idxPt1': 72	, 'idxPt2':73},
{'idx':57	,'idxPt1': 74	, 'idxPt2':75},
{'idx':58	,'idxPt1': 75	, 'idxPt2':76},
{'idx':59	,'idxPt1': 77	, 'idxPt2':78},
{'idx':60	,'idxPt1': 78	, 'idxPt2':80},
{'idx':61	,'idxPt1': 79	, 'idxPt2':81},
{'idx':62	,'idxPt1': 81	, 'idxPt2':83},
]


# CamRotZdiv4 = CamRotZ >> 2;

# idxSeg = tabIdxSeg [CamRotZdiv4]
# nbSeg = tabNbSeg [CamRotZdiv4]

# while (nbSeg >= 0) {
#     idxPt1 = tabSegPt1[idxSeg]
#     idxPt2 = tabSegPt2[idxSeg]
#     X1 = tabPointsX[idxPt1]-f(CamRotZdiv4)
#     Y1 = tabPointsY[idxPt1]
#     X2 = tabPointsX[idxPt2]-f(CamRotZdiv4)
#     Y2 = tabPointsY[idxPt3]
#     idxSeg = idxSeg + 1;
#     nbSeg --;
# }


## TABLE TO EXPORT
tabPointsX=[p['X'] for p in tabPoints]
tabPointsY=[p['Y'] for p in tabPoints]

tabSegPt1=[s['idxPt1'] for s in tabSegments]
tabSegPt2=[s['idxPt2'] for s in tabSegments]

tabIdxFirstSeg=[]
tabNbLeftClipSeg=[]
tabNbRightClipSeg=[]
tabNoClipSeg=[]
tabOffset=[]


ANGLE_OF_VIEW = 62.43902439
ANGLE2PIXEL = 256.0/984.0
def main ():

    # print ("coucou", ANGLE2PIXEL)

    for ii in range (0,64):
        #print (ii*4.0, " => ",(ii*4.0+ANGLE_OF_VIEW))
        ## recherche des points dans le FOV
        lPointsInFov = [p['idx'] for p in tabPoints if ((p['X']*ANGLE2PIXEL >= ii*4.0) and (p['X']*ANGLE2PIXEL < ii*4.0+ANGLE_OF_VIEW ))]
        
        ## recherche des segments ayant au moins un point dans le FOV
        lSegInPov = [s['idx'] for s in tabSegments if ((s['idxPt1'] in lPointsInFov) or (s['idxPt2'] in lPointsInFov))]
        #print (lSegInPov)
        firstSeg = min (lSegInPov)
        

        nbSeg = max (lSegInPov) - firstSeg + 1

        ## calcul du nombre de segments Ã  clipper
        leftClip = [sinpov for sinpov in lSegInPov if tabSegments[sinpov]['idxPt1'] not in lPointsInFov]
        if len(leftClip) > 0:
            nbLeftClip = max(leftClip) - min (leftClip) + 1
        else :
            nbLeftClip = 0
        rightClip = [sinpov for sinpov in lSegInPov if tabSegments[sinpov]['idxPt2'] not in lPointsInFov]
        if len(rightClip) > 0:
            nbRightClip = max(rightClip) - min (rightClip) + 1
        else:
            nbRightClip = 0

        nbNoClip = nbSeg - nbLeftClip - nbRightClip
        
        print (ii*4.0, " => ",(ii*4.0+ANGLE_OF_VIEW), firstSeg, nbLeftClip, nbNoClip, nbRightClip)
        tabIdxFirstSeg.append(firstSeg)
        tabNbLeftClipSeg.append (nbLeftClip)
        tabNoClipSeg.append (nbNoClip)
        tabNbRightClipSeg.append (nbRightClip)
        tabOffset.append (round(ii*4.0/ANGLE2PIXEL))

# extern unsigned int  tabPointsX[];
# extern unsigned char tabPointsY[];

# extern unsigned char tabSegPt1[];
# extern unsigned char tabSegPt2[];

# extern unsigned char tabIdxFirstSeg[];
# extern unsigned char tabNbLeftClipSeg[];
# extern unsigned char tabNbRightClipSeg[];
# extern unsigned char tabNoClipSeg[];
# extern unsigned int  tabOffset[];

    with open("landscape_c.c", "w") as f:
        f.write ("unsigned int  tabPointsX[] = {" + ', '.join(map(str,tabPointsX)) + "};\n")
        f.write ("unsigned char tabPointsY[] = {" + ', '.join(map(str,tabPointsY)) + "};\n")
        f.write ("unsigned char tabSegPt1[] = {" + ', '.join(map(str,tabSegPt1)) + "};\n")
        f.write ("unsigned char tabSegPt2[] = {" + ', '.join(map(str,tabSegPt2)) + "};\n")
        f.write ("unsigned char tabIdxFirstSeg[] = {" + ', '.join(map(str,tabIdxFirstSeg)) + "};\n")
        f.write ("unsigned char tabNbLeftClipSeg[] = {" + ', '.join(map(str,tabNbLeftClipSeg)) + "};\n")
        f.write ("unsigned char tabNbRightClipSeg[] = {" + ', '.join(map(str,tabNbRightClipSeg)) + "};\n")
        f.write ("unsigned char tabNoClipSeg[] = {" + ', '.join(map(str,tabNoClipSeg)) + "};\n")
        f.write ("unsigned int  tabOffset[] = {" + ', '.join(map(str,tabOffset)) + "};\n")

    with open("landscape_s.s", "w") as f:
        f.write ("_tabPointsX\n\t.word " + '\n\t.word '.join(map(str,tabPointsX)) + "\n")
        f.write ("_tabPointsY\n\t.byt " + '\n\t.byt '.join(map(str,tabPointsY)) + "\n")
        f.write ("_tabSegPt1\n\t.byt " + '\n\t.byt '.join(map(str,tabSegPt1)) + "\n")
        f.write ("_tabSegPt2\n\t.byt " + '\n\t.byt '.join(map(str,tabSegPt2)) + "\n")
        f.write ("_tabIdxFirstSeg\n\t.byt " + '\n\t.byt '.join(map(str,tabIdxFirstSeg)) + "\n")
        f.write ("_tabNbLeftClipSeg\n\t.byt " + '\n\t.byt '.join(map(str,tabNbLeftClipSeg)) + "\n")
        f.write ("_tabNbRightClipSeg\n\t.byt " + '\n\t.byt '.join(map(str,tabNbRightClipSeg)) + "\n")
        f.write ("_tabNoClipSeg\n\t.byt " + '\n\t.byt '.join(map(str,tabNoClipSeg)) + "\n")
        f.write ("_tabOffset\n\t.word " + '\n\t.word '.join(map(str,tabOffset)) + "\n")
        # f.write ("unsigned char tabPointsY[] = {" + ', '.join(map(str,tabPointsY)) + "};\n")
        # f.write ("unsigned char [] = {" + ', '.join(map(str,tabSegPt1)) + "};\n")
        # f.write ("unsigned char [] = {" + ', '.join(map(str,tabSegPt2)) + "};\n")
        # f.write ("unsigned char [] = {" + ', '.join(map(str,tabIdxFirstSeg)) + "};\n")
        # f.write ("unsigned char [] = {" + ', '.join(map(str,tabNbLeftClipSeg)) + "};\n")
        # f.write ("unsigned char [] = {" + ', '.join(map(str,tabNbRightClipSeg)) + "};\n")
        # f.write ("unsigned char [] = {" + ', '.join(map(str,tabNoClipSeg)) + "};\n")
        # f.write ("unsigned int  [] = {" + ', '.join(map(str,tabOffset)) + "};\n")

if __name__ == '__main__':

    main()
